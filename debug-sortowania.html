<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sortowania</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Debug Funkcji Sortowania</h1>
    
    <div class="test">
        <h2>Test dostÄ™pu do gÅ‚Ã³wnej aplikacji</h2>
        <button onclick="debugMainApp()">Debug GÅ‚Ã³wna Aplikacja</button>
        <div id="debugResults"></div>
    </div>

    <div class="test">
        <h2>GÅ‚Ã³wna aplikacja</h2>
        <iframe id="mainApp" src="http://localhost:8000/" width="100%" height="500"></iframe>
    </div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('debugResults').appendChild(div);
        }

        function debugMainApp() {
            document.getElementById('debugResults').innerHTML = '';
            log('RozpoczÄ™cie debugowania...', 'info');
            
            const iframe = document.getElementById('mainApp');
            
            if (!iframe) {
                log('âŒ Iframe nie znaleziony', 'error');
                return;
            }
            
            try {
                const win = iframe.contentWindow;
                const doc = iframe.contentDocument || win.document;
                
                log('âœ… DostÄ™p do iframe uzyskany', 'success');
                
                // SprawdÅº czy Firebase auth jest zaÅ‚adowany
                if (win.auth) {
                    log('âœ… Firebase auth znaleziony', 'success');
                    if (win.auth.currentUser) {
                        log(`âœ… UÅ¼ytkownik zalogowany: ${win.auth.currentUser.email}`, 'success');
                    } else {
                        log('âš ï¸ Brak zalogowanego uÅ¼ytkownika', 'info');
                    }
                } else {
                    log('âŒ Firebase auth nie znaleziony', 'error');
                }
                
                // SprawdÅº elementy sortowania
                const toggleSort = doc.getElementById('toggleSort');
                const sortContainer = doc.getElementById('sortContainer');
                const sortOrder = doc.getElementById('sortOrder');
                
                log(`Toggle sort button: ${toggleSort ? 'âœ…' : 'âŒ'}`, toggleSort ? 'success' : 'error');
                log(`Sort container: ${sortContainer ? 'âœ…' : 'âŒ'}`, sortContainer ? 'success' : 'error');
                log(`Sort order select: ${sortOrder ? 'âœ…' : 'âŒ'}`, sortOrder ? 'success' : 'error');
                
                if (toggleSort) {
                    log(`Tekst przycisku: "${toggleSort.textContent.trim()}"`, 'info');
                }
                
                if (sortContainer) {
                    const style = win.getComputedStyle(sortContainer);
                    log(`WidocznoÅ›Ä‡ kontenera: ${style.display}`, 'info');
                }
                
                if (sortOrder) {
                    log(`WartoÅ›Ä‡ sortowania: ${sortOrder.value}`, 'info');
                    log(`Event listener attached: ${sortOrder.hasAttribute('data-listener-added')}`, 'info');
                }
                
                // SprawdÅº funkcje globalne
                if (win.loadApplications) {
                    log('âœ… Funkcja loadApplications dostÄ™pna', 'success');
                } else {
                    log('âŒ Funkcja loadApplications niedostÄ™pna', 'error');
                }
                
                // Test klikniÄ™cia przycisku toggle
                if (toggleSort) {
                    log('ðŸ”„ TestujÄ™ klikniÄ™cie przycisku toggle...', 'info');
                    toggleSort.click();
                    
                    setTimeout(() => {
                        if (sortContainer) {
                            const newStyle = win.getComputedStyle(sortContainer);
                            log(`WidocznoÅ›Ä‡ po klikniÄ™ciu: ${newStyle.display}`, 'info');
                            
                            if (sortOrder && newStyle.display !== 'none') {
                                log('ðŸ”„ TestujÄ™ zmianÄ™ wartoÅ›ci sortowania...', 'info');
                                sortOrder.value = 'asc';
                                
                                // Triggeruj event
                                const event = new Event('change', { bubbles: true });
                                sortOrder.dispatchEvent(event);
                                
                                setTimeout(() => {
                                    log('Event change zostaÅ‚ wysÅ‚any', 'info');
                                }, 100);
                            }
                        }
                    }, 200);
                }
                
            } catch (error) {
                log(`âŒ BÅ‚Ä…d: ${error.message}`, 'error');
                console.error('Debug error:', error);
            }
        }

        // Auto debug po zaÅ‚adowaniu
        window.onload = function() {
            setTimeout(() => {
                log('Strona debug zaÅ‚adowana. Kliknij "Debug GÅ‚Ã³wna Aplikacja" aby rozpoczÄ…Ä‡ testy.', 'info');
            }, 2000);
        };
    </script>
</body>
</html>
